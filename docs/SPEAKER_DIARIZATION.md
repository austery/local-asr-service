# è¯´è¯äººåˆ†ç¦»åŠŸèƒ½è¯´æ˜

## å½“å‰çŠ¶æ€

### API æ”¯æŒ
âœ… **API å±‚å·²å®Œå…¨å®ç°**
- æ”¯æŒ `response_format=verbose_json` å‚æ•°
- è¿”å›åŒ…å« `segments` æ•°ç»„ï¼ˆå«æ—¶é—´æˆ³ï¼‰
- Segment æ¨¡å‹åŒ…å« `speaker` å­—æ®µ

### æ¨¡å‹æ”¯æŒ
âš ï¸ **å½“å‰ä½¿ç”¨çš„ Qwen3-ASR-1.7B-4bit ä¸æ”¯æŒè¯´è¯äººåˆ†ç¦»**
- `speaker` å­—æ®µè¿”å› `null`
- ä»ç„¶æä¾›å‡†ç¡®çš„è½¬å½•æ–‡æœ¬å’Œæ—¶é—´æˆ³
- æ€§èƒ½ä¼˜ç§€ï¼š17åˆ†é’ŸéŸ³é¢‘ä»…éœ€2åˆ†10ç§’

## æµ‹è¯•çš„æ¨¡å‹

| æ¨¡å‹ | è¯´è¯äººåˆ†ç¦» | é•¿éŸ³é¢‘æ”¯æŒ | å¤„ç†é€Ÿåº¦ | æ¨è |
|-----|----------|-----------|---------|-----|
| **Qwen3-ASR-1.7B-4bit** | âŒ | âœ… (>17min) | âš¡ å¿« | âœ… æ¨è |
| VibeVoice-ASR-4bit | âŒ* | âŒ (è¶…æ—¶) | ğŸ¢ æ…¢ | âŒ |

*VibeVoice å·ç§°æ”¯æŒä½†æœªèƒ½æ­£å¸¸å·¥ä½œ

## API ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€è½¬å½•ï¼ˆä»…æ–‡æœ¬ï¼‰
```bash
curl -X POST http://localhost:50070/v1/audio/transcriptions \
  -F "file=@audio.mp3" \
  -F "response_format=json" \
  -F "language=zh"
```

**è¿”å›ç¤ºä¾‹ï¼š**
```json
{
  "text": "å®Œæ•´çš„è½¬å½•æ–‡æœ¬...",
  "duration": 45.2,
  "model": "mlx-community/Qwen3-ASR-1.7B-4bit"
}
```

### è¯¦ç»†è½¬å½•ï¼ˆå«æ—¶é—´æˆ³ï¼‰
```bash
curl -X POST http://localhost:50070/v1/audio/transcriptions \
  -F "file=@audio.mp3" \
  -F "response_format=verbose_json" \
  -F "language=zh"
```

**è¿”å›ç¤ºä¾‹ï¼š**
```json
{
  "text": "å®Œæ•´çš„è½¬å½•æ–‡æœ¬...",
  "duration": 45.2,
  "language": "zh",
  "model": "mlx-community/Qwen3-ASR-1.7B-4bit",
  "segments": [
    {
      "id": 0,
      "speaker": null,
      "start": 0.0,
      "end": 3.5,
      "text": "ç¬¬ä¸€æ®µè¯"
    },
    {
      "id": 1,
      "speaker": null,
      "start": 3.5,
      "end": 7.2,
      "text": "ç¬¬äºŒæ®µè¯"
    }
  ]
}
```

## å¦‚ä½•å¯ç”¨è¯´è¯äººåˆ†ç¦»ï¼Ÿ

### æ–¹æ¡ˆ1: ç­‰å¾…æ¨¡å‹æ›´æ–°
- å…³æ³¨ HuggingFace ä¸Šæ–°å‘å¸ƒçš„ MLX æ ¼å¼æ¨¡å‹
- æµ‹è¯•æ˜¯å¦åŸç”Ÿæ”¯æŒè¯´è¯äººåˆ†ç¦»
- ç›®å‰å·²çŸ¥æ”¯æŒçš„æ¨¡å‹è¾ƒå°‘

### æ–¹æ¡ˆ2: é›†æˆ pyannote-audioï¼ˆæ¨èï¼‰
å¦‚æœç¡®å®éœ€è¦è¯´è¯äººåˆ†ç¦»åŠŸèƒ½ï¼Œå¯ä»¥é›†æˆç‹¬ç«‹çš„è¯´è¯äººåˆ†ç¦»åº“ã€‚

#### å®ç°æ–¹æ¡ˆ
1. æ·»åŠ ä¾èµ–ï¼š`pyannote-audio`
2. åœ¨éŸ³é¢‘é¢„å¤„ç†é˜¶æ®µè¿›è¡Œè¯´è¯äººåˆ†ç¦»
3. å°†è¯´è¯äººä¿¡æ¯ä¸è½¬å½•ç»“æœå¯¹é½
4. æ›´æ–° segments ä¸­çš„ speaker å­—æ®µ

#### é¢„ä¼°å·¥ä½œé‡
- å¼€å‘æ—¶é—´ï¼š2-3å°æ—¶
- å¢åŠ ä¾èµ–ï¼špyannote-audio + torch
- å†…å­˜å¢åŠ ï¼š~2GBï¼ˆpyannote æ¨¡å‹ï¼‰

#### ä¼˜åŠ¿
- ä¸“ä¸šçš„è¯´è¯äººåˆ†ç¦»æ•ˆæœ
- ä¸è½¬å½•æµç¨‹è§£è€¦
- å¯ä»¥é€‰æ‹©æ˜¯å¦å¯ç”¨

#### åŠ£åŠ¿
- å¢åŠ å¤„ç†æ—¶é—´ï¼ˆçº¦30%ï¼‰
- éœ€è¦é¢å¤–çš„æ¨¡å‹ä¸‹è½½
- å¢åŠ ç³»ç»Ÿå¤æ‚åº¦

## æ¶æ„è®¾è®¡

å½“å‰æ¶æ„å·²ç»ä¸ºè¯´è¯äººåˆ†ç¦»é¢„ç•™äº†æ¥å£ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Layer     â”‚  â† å·²æ”¯æŒ verbose_json æ ¼å¼
â”‚  (routes.py)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service Layer  â”‚  â† é€ä¼  response_format å‚æ•°
â”‚ (transcription) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MLX Engine     â”‚  â† æ”¯æŒ format=json å‚æ•°
â”‚ (mlx_engine.py) â”‚  â† åˆå¹¶å¤šä¸ªåˆ†ç‰‡çš„ segments
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MLX Model      â”‚  â† Qwen3-ASR (æ— è¯´è¯äººåˆ†ç¦»)
â”‚                 â”‚  â† å¯æ›¿æ¢ä¸ºæ”¯æŒçš„æ¨¡å‹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å¦‚éœ€é›†æˆ pyannoteï¼Œåœ¨ MLX Engine ä¹‹å‰æ·»åŠ ä¸€ä¸ªé¢„å¤„ç†æ­¥éª¤å³å¯ã€‚

## ç›¸å…³æ–‡æ¡£
- [æ¨¡å‹åˆ‡æ¢æ€»ç»“](/tmp/model_switch_summary.md)
- [API æ–‡æ¡£](../README.md)
